{% extends "releasemanager/base.html" %}
{% load i18n %}

{% block title %}{% trans "JAR/JAD Manager" %}{% endblock %}

{% block releasemanager_content %}
	<h2>{% trans "Submit New Build" %}</h2>
	
	<form action="{% url releasemanager.views.core_new %}" method="POST" accept-charset="utf-8" enctype="multipart/form-data">
		{{form.as_ul}}
		<input type="submit" value="Submit" />
	</form>
	{{errors}}
	

	<!-- list existing files -->
	
	<!-- uploaded_by = models.ForeignKey(User, related_name="core_uploaded") 
    released_by = models.ForeignKey(User, related_name="core_released", null=True, blank=True) 

    created_at = models.DateTimeField(auto_now_add=True)

    description = models.CharField(max_length=512, null=True, blank=True)
    build_number = models.PositiveIntegerField(help_text="the teamcity build number")
    revision_number = models.CharField(max_length=255, null=True, blank=True, help_text="the source control revision number")
    version = models.CharField(max_length=20, null=True, blank=True, help_text = 'the "release" version.  e.g. 2.0.1')

    jar_file = models.FilePathField(_('JAR File Location'), match='.*\.jar$', recursive=True, path=FILE_PATH, max_length=255)
    jad_file = models.FilePathField(_('JAD File Location'), match='.*\.jad$', recursive=True, path=FILE_PATH, max_length=255) -->
	
	
	{% if builds %}
	<table>
	<thead>
		<th>Build #</th>
		<th>Created At</th>
		<th>Downloads</th>
		<th>Uploaded By</th>
		<th>Build Status</th>
		<th>Description</th>
		<th>Build Server URL</th>
		<th></th>
	</thead>
	{% for build in builds %}

	    <tr class="{% cycle 'odd' 'even' %}">
	        <td><a href="{% url buildmanager.views.show_build build.id %}">{{build.build_number}}</a></td>
	        <td>{{build.created_at|date}} {{build.created_at|time}}</td>
	        <td><a href="{{build.get_jar_downloadurl}}">
	            {{build.get_jar_filename}}</a><br />
	            <a href="{{build.get_jad_downloadurl}}" onmouseout="hideTooltip()" onmouseover="showTooltip(event,'{{build.get_jad_contents}}');return false"> 
	            {{build.get_jad_filename}}</a><br />
	            <a href="{{build.get_zip_downloadurl}}">Zip Archive</a>
	        </td>
	        <td>{{build.uploaded_by}}</td>
	        <td>{{build.get_status_display}}</td>        
	        <td>{{build.description}}</td>
	        <td><a href="{{build.get_buildURL}}">Build URL</a></td>
	        <td>{% if not build.is_release %}
	           <button onclick="location.assign('{% url buildmanager.views.release build.id %}');">Promote to Release</button>
	            {% endif %}
	        </td>
	    </tr>

	{%endfor%}
	</table>
	{% else %}
	No builds found
	{% endif %}
	
	
{%endblock%}